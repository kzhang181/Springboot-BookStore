<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book Management System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        h2 { margin-top: 2em; }
        input, button { margin: 0.5em 0; }
        table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 0.5em; }
    </style>
</head>
<body>
    <h1>Book Management System</h1>

    <h2>Add Author</h2>
    <form id="authorForm">
        <input type="text" id="authorFirstName" placeholder="First Name" required>
        <input type="text" id="authorLastName" placeholder="Last Name" required>
        <button type="submit">Add Author</button>
    </form>
    <div id="authorMsg"></div>

    <h2>Authors</h2>
    <table id="authorsTable">
        <thead>
            <tr><th>ID</th><th>First Name</th><th>Last Name</th><th>Delete</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>Add Book</h2>
    <form id="bookForm">
        <input type="text" id="bookTitle" placeholder="Book Title" required>
        <select id="bookAuthor" required></select>
        <button type="submit">Add Book</button>
    </form>
    <div id="bookMsg"></div>

    <h2>Books</h2>
    <table id="booksTable">
        <thead>
            <tr><th>ID</th><th>Title</th><th>Author</th><th>Delete</th></tr>
        </thead>
        <tbody></tbody>
    </table>

<script>
const apiBase = "http://localhost:8080";

// Load authors and books on page load
window.onload = function() {
    loadAuthors();
    loadBooks();
};

function loadAuthors() {
    fetch(apiBase + "/authors")
        .then(res => res.json())
        .then(authors => {
            const tbody = document.querySelector("#authorsTable tbody");
            tbody.innerHTML = "";
            authors.forEach(a => {
                const row = `<tr><td>${a.id}</td><td>${a.firstName || a.first_name}</td><td>${a.lastName || a.last_name}</td><td><button onclick="deleteAuthor(${a.id})">Delete</button></td></tr>`;
                tbody.innerHTML += row;
            });
            const select = document.getElementById("bookAuthor");
            select.innerHTML = "";
            authors.forEach(a => {
                select.innerHTML += `<option value="${a.id}">${a.firstName || a.first_name} ${a.lastName || a.last_name}</option>`;
            });
        });
}

function loadBooks() {
    fetch(apiBase + "/books")
        .then(res => res.json())
        .then(books => {
            const tbody = document.querySelector("#booksTable tbody");
            tbody.innerHTML = "";
            books.forEach(b => {
                const author = b.author ? `${b.author.firstName || b.author.first_name} ${b.author.lastName || b.author.last_name}` : "N/A";
                const row = `<tr><td>${b.id}</td><td>${b.title}</td><td>${author}</td><td><button onclick="deleteBook(${b.id})">Delete</button></td></tr>`;
                tbody.innerHTML += row;
            });
        });
}

function deleteAuthor(id) {
    if (confirm("Are you sure you want to delete this author?")) {
        fetch(apiBase + "/authors/" + id, { method: "DELETE" })
            .then(() => {
                loadAuthors();
                loadBooks(); // Refresh books in case any were linked to this author
            });
    }
}

function deleteBook(id) {
    if (confirm("Are you sure you want to delete this book?")) {
        fetch(apiBase + "/books/" + id, { method: "DELETE" })
            .then(() => loadBooks());
    }
}

// Add Author
document.getElementById("authorForm").onsubmit = function(e) {
    e.preventDefault();
    const data = {
        firstName: document.getElementById("authorFirstName").value,
        lastName: document.getElementById("authorLastName").value
    };
    fetch(apiBase + "/authors", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(() => {
        document.getElementById("authorMsg").textContent = "Author added!";
        loadAuthors();
    });
};

// Add Book
document.getElementById("bookForm").onsubmit = function(e) {
    e.preventDefault();
    const data = {
        title: document.getElementById("bookTitle").value,
        author: { id: document.getElementById("bookAuthor").value }
    };
    fetch(apiBase + "/books", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(() => {
        document.getElementById("bookMsg").textContent = "Book added!";
        loadBooks();
    });
};
</script>
</body>
</html>